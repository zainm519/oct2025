<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Mon Monde Sous-Marin</title>

    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  </head>

  <body>
    <!-- Bouton pour le son -->
    <button id="soundButton">Activer le son</button>

    <a-scene>
      <!-- Assets -->
      <a-assets>
        <a-asset-item id="albert-obj" src="./tortue/model_46a_-_subadult_green_sea_turtle.obj"></a-asset-item>
        <a-asset-item id="albert-mtl" src="./tortue/model_46a_-_subadult_green_sea_turtle.mtl"></a-asset-item>
        <a-asset-item id="bruce" src="./shark.glb"></a-asset-item>
        <a-asset-item id="statueModel" src="./statue_of_emperor_trajan_tower_hill_london.glb"></a-asset-item>
        <a-asset-item id="franklin" src="./tortue.gltf"></a-asset-item>
        <audio id="bruce-sound" src="bruce.mp3"></audio>
      </a-assets>

      <!-- Caméra avec curseur pour détecter les clics -->
      <a-entity camera position="0 1.6 0" look-controls>
        <a-entity cursor="rayOrigin: mouse"></a-entity>
      </a-entity>

      <!-- Ciel -->
      <a-sky src="./panorama1.jpg"></a-sky>

      <!-- Tortues -->
      <a-obj-model src="#albert-obj" mtl="#albert-mtl" position="0 0 -3"></a-obj-model>

      <!-- Requin animé avec son -->
      <a-entity id="nage" rotation="0 0 0" animation="property: rotation; to: 0 359 0; dur: 20000; loop: true; easing: linear">
        <a-entity id="bruce"
                  gltf-model="#bruce"
                  position="-10.5 1.8 0"
                  rotation="0 0 -6.6"
                  animation-mixer
                  sound="src: #bruce-sound; autoplay: false; loop: true; volume: 0.5">
        </a-entity>
      </a-entity>

      <!-- Statue avec effet de bulles -->
      <a-gltf-model id="statue"
                    src="#statueModel"
                    position="0 -2.14543 -10.31513"
                    bubble-emitter>
      </a-gltf-model>
      <a-entity light="" position="2.51922 0 -0.17956"></a-entity>
    </a-scene>

    <!-- Scripts JS -->
    <script>
      // Activation du son via le bouton
      document.getElementById('soundButton').addEventListener('click', function () {
        const bruce = document.querySelector('#bruce');
        if (bruce && bruce.components.sound) {
          bruce.components.sound.playSound();
        }
      });

      // Composant personnalisé pour générer des bulles
      AFRAME.registerComponent('bubble-emitter', {
        init: function () {
          this.el.addEventListener('click', () => {
            for (let i = 0; i < 10; i++) {
              this.spawnBubble();
            }
          });
        },

        spawnBubble: function () {
          const bubble = document.createElement('a-sphere');
          const pos = this.el.object3D.position;

          const x = pos.x + (Math.random() - 0.5) * 0.5;
          const y = pos.y + 1;
          const z = pos.z + (Math.random() - 0.5) * 0.5;

          bubble.setAttribute('position', { x, y, z });
          bubble.setAttribute('radius', 0.05 + Math.random() * 0.05);
          bubble.setAttribute('color', '#aeeeee');
          bubble.setAttribute('opacity', 0.6);
          bubble.setAttribute('transparent', true);

          bubble.setAttribute('animation__move', {
            property: 'position',
            to: `${x} ${y + 3} ${z}`,
            dur: 3000 + Math.random() * 1000,
            easing: 'easeOutQuad'
          });

          bubble.setAttribute('animation__fade', {
            property: 'material.opacity',
            to: 0,
            dur: 3000 + Math.random() * 1000,
            easing: 'linear'
          });

          setTimeout(() => {
            bubble.remove();
          }, 4000);

          document.querySelector('a-scene').appendChild(bubble);
        }
      });
    </script>
  </body>
</html>
