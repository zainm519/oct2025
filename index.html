<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Mon Monde A-Frame</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  </head>
  <body>
    <button id="soundButton">Activer le son</button>

    <a-scene>
      <a-assets>
        <a-asset-item id="albert-obj" src="./tortue/model_46a_-_subadult_green_sea_turtle.obj"></a-asset-item>
        <a-asset-item id="albert-mtl" src="./tortue/model_46a_-_subadult_green_sea_turtle.mtl"></a-asset-item>
        <a-asset-item id="bruce-model" src="./shark.glb"></a-asset-item>
        <a-asset-item id="statue-model" src="./statue_of_emperor_trajan_tower_hill_london.glb"></a-asset-item>
        <a-asset-item id="franklin" src="./tortue.gltf"></a-asset-item>
        <audio id="bruce-sound" src="bruce.mp3"></audio>
      </a-assets>
      <a-entity camera look-controls>
  <a-entity cursor="rayOrigin: mouse"></a-entity>
</a-entity>
      <a-entity camera position="0 1.6 0" look-controls></a-entity>
      <a-sky src="./panorama1.jpg"></a-sky>
      <a-obj-model src="#albert-obj" mtl="#albert-mtl" position="0 0 -3"></a-obj-model>
      <a-entity id="nage" rotation="0 0 0" animation="property: rotation; to: 0 359 0; dur: 20000; loop: true; easing: linear">
        <a-entity id="bruce" 
                  gltf-model="#bruce-model" 
                  position="-10.5 1.8 0" 
                  rotation="0 0 -6.6" 
                  animation-mixer
                  sound="src: #bruce-sound; autoplay: false; loop: true; volume: 0.5;">
        </a-entity>
      </a-entity>
      <a-gltf-model id="statue"
              src="#statue-model"
              position="0 -2.14 -10.31"
              bubble-emitter>
</a-gltf-model>
    </a-scene>
    <script>
      document.querySelector('#soundButton').addEventListener('click', function () {
        const bruce = document.querySelector('#bruce');
        if (bruce && bruce.components.sound) {
          bruce.components.sound.playSound();
        }
      });
    </script>
    <script>
  AFRAME.registerComponent('bubble-emitter', {
    init: function () {
      this.el.addEventListener('click', () => {
        for (let i = 0; i < 10; i++) {
          this.spawnBubble();
        }
      });
    },

    spawnBubble: function () {
      const bubble = document.createElement('a-sphere');
      const pos = this.el.object3D.position;

      // Position aléatoire proche de la statue
      bubble.setAttribute('position', {
        x: pos.x + (Math.random() - 0.5) * 0.5,
        y: pos.y + 1,
        z: pos.z + (Math.random() - 0.5) * 0.5
      });

      // Apparence des bulles
      bubble.setAttribute('radius', 0.05 + Math.random() * 0.05);
      bubble.setAttribute('color', '#aeeeee');
      bubble.setAttribute('opacity', 0.6);
      bubble.setAttribute('transparent', true);

      // Animation vers le haut
      bubble.setAttribute('animation__move', {
        property: 'position',
        to: `${bubble.getAttribute('position').x} ${pos.y + 3} ${bubble.getAttribute('position').z}`,
        dur: 3000 + Math.random() * 1000,
        easing: 'easeOutQuad'
      });

      // Animation de disparition
      bubble.setAttribute('animation__fade', {
        property: 'material.opacity',
        to: 0,
        dur: 3000 + Math.random() * 1000,
        easing: 'linear'
      });

      // Supprimer la bulle après 4 secondes
      setTimeout(() => {
        bubble.remove();
      }, 4000);

      // Ajouter à la scène
      document.querySelector('a-scene').appendChild(bubble);
    }
  });
</script>
  </body>
</html>
